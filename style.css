/*
 * ============================================================
 *  JUICE BOX — Stylesheet
 * ============================================================
 *  This file handles all visual presentation: layout, colors,
 *  animations, and hover effects.
 *
 *  Design tokens (shared values) are stored as CSS custom
 *  properties on :root so they can be reused across rules —
 *  and even read from JavaScript (see utils.js → FADE_MS).
 * ============================================================
 */

/* ---- Design tokens ---- */
:root {
    /* A "bouncy" easing curve that overshoots then settles.
       Used for both the entrance animation and the hover effect. */
    --bounce-ease: cubic-bezier(0.34, 1.56, 0.64, 1);

    /* Title and mode buttons */
    --font-title: "Cherry Bomb One", system-ui;

    /* Each grid cell is a square whose side length is dynamically calculated
       in JavaScript as min(1/(cols+2) of width, 1/(rows+2) of height).
       See level.js GRID_COLUMNS, GRID_ROWS (single source for grid shape). */
    --cell-size: 60px;

    /* How long the fade-out lasts when transitioning between levels.
       utils.js reads this as FADE_MS so LEVEL_TRANSITION_DELAY stays in sync.
       Matches Juice Box button and mode screen (300ms). */
    --fade-duration: 300ms;
}

/* ---- Reset & global defaults ---- */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;

    /* Prevent mobile browsers from waiting 300ms on tap (to detect
       double-tap-to-zoom). Doesn't inherit, so applying to * ensures
       every element gets it. */
    touch-action: manipulation;
}

/* ---- Full-viewport canvas ---- */
html,
body {
    width: 100%;
    height: 100%;
    overflow: hidden;  /* No scrollbars — the game fills the screen */
    max-width: 100vw;
    max-height: 100vh;
}

body {
    /* Warm peach-to-coral gradient background */
    background: linear-gradient(145deg, #ffecd2 0%, #fcb69f 50%, #f7a99c 100%);

    /* Center the grid dead-center in the viewport */
    display: flex;
    justify-content: center;
    align-items: center;

    /* Minimal padding to reduce margin between grid and screen edges */
    padding: 0.5%;

    /* Prevent text selection when rapidly clicking sprites */
    user-select: none;
    -webkit-user-select: none;  /* Safari fallback */
}

/* ---- Title screen ----
   Covers the full viewport. First shows the title; a click fades it out
   and shows the mode screen. Clicking a mode starts the game. */
#title-screen {
    position: fixed;
    inset: 0;                       /* Stretch to fill the entire viewport */
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    z-index: 10;                    /* Sit above the grid */
    transition: opacity 0.5s ease;
    overflow: hidden;               /* Prevent any content overflow */
    max-width: 100vw;
    max-height: 100vh;

    /* Start invisible to prevent FOUT (Flash of Unstyled Text).
       game.js adds .ready once the Cherry Bomb One font has loaded. */
    opacity: 0;
}

/* Fade in once the font is confirmed loaded */
#title-screen.ready {
    opacity: 1;
}

/* When JS adds .hidden, fade out and disable interaction.
   visibility: hidden ensures the full-viewport layer is fully removed from
   hit-testing so grid hover works reliably in all browsers. */
#title-screen.hidden {
    opacity: 0;
    pointer-events: none;
    visibility: hidden;
}

/* Stack title and mode screen in the same area */
#title,
#mode-screen {
    position: absolute;
    inset: 0;
    display: flex;
    justify-content: center;
    align-items: center;
}

#title {
    font-family: var(--font-title);
    font-weight: 400;
    font-style: normal;
    color: white;
    font-size: clamp(80px, 20vmin, 200px);  /* Very, very big */
    line-height: 1.1;
    text-align: center;
    transition: opacity 0.5s ease;

    /* Stack the two <span> children ("Juice" / "Box") vertically */
    flex-direction: column;
}

/* When mode screen is shown, title fades out */
#title.faded {
    opacity: 0;
    pointer-events: none;
}

/* ---- Mode screen ----
   Two wide borderless buttons; hover reveals a shiny line that grows left-to-right.
   Buttons and their contents scale with screen width (inner 70% of viewport),
   horizontally centered. */
#mode-screen {
    flex-direction: column;
    align-items: center;
    left: 15vw;
    right: 15vw;
    width: auto;
    gap: clamp(1.5vw, 4vmin, 4vw);
    padding: 0;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.5s ease;
}

#mode-screen:not(.hidden) {
    opacity: 1;
    pointer-events: auto;
}

#mode-screen.hidden {
    visibility: hidden;
}

#mode-screen.fade-out {
    opacity: 0;
    transition-duration: 0.3s;  /* Matches Juice Box button fade */
}

/* Wide borderless mode button: icon + text left-aligned; hover shows top/bottom shimmer line.
   Sized to fill the mode screen (70vw); font and icon scale proportionally. */
.mode-btn {
    display: flex;
    align-items: center;
    gap: 0.5em;
    width: 100%;
    padding: clamp(0.4rem, 1.5vw, 1rem) 0;
    border: none;
    background: transparent;
    color: white;
    font-family: var(--font-title);
    font-weight: 400;
    font-size: clamp(16px, 4.5vw, 36px);
    text-align: left;
    cursor: pointer;
    position: relative;
    -webkit-tap-highlight-color: transparent;
    outline: none;
}

/* Icon scales with font-size (em) so it stays proportionate to the label */
.mode-btn-icon {
    width: 1.2em;
    height: 1.2em;
    object-fit: contain;
    flex-shrink: 0;
    pointer-events: none;
}

/* Top and bottom "border" lines: shiny gradient that grows left→right on hover */
.mode-btn::before,
.mode-btn::after {
    content: '';
    position: absolute;
    left: 0;
    height: 2px;
    width: 0;
    background: linear-gradient(
        90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.4) 25%,
        rgba(255, 255, 255, 0.95) 50%,
        rgba(255, 255, 255, 0.4) 75%,
        transparent 100%
    );
    transition: width 0.4s ease;
    box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
}

.mode-btn::before { top: 0; }
.mode-btn::after { bottom: 0; }

.mode-btn:hover::before,
.mode-btn:hover::after {
    width: 100%;
}

/* ---- The invisible grid that holds all sprite cells ---- */
#grid {
    display: grid;
    grid-template-columns: repeat(var(--grid-columns), auto);
    grid-template-rows: repeat(var(--grid-rows), auto);
    overflow: visible;                        /* Allow sprites to scale without clipping */
    max-width: 100vw;
    max-height: 100vh;

    /* Responsive gap between cells, same clamping idea as --cell-size */
    gap: clamp(6px, 1.2vmin, 14px);
}

/* ---- Individual sprite cell ---- */
.cell {
    width: var(--cell-size);
    aspect-ratio: 1;                /* Square: height equals width */
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    overflow: visible;              /* Allow sprites to scale beyond cell bounds without clipping */

    /* Remove tap highlight on mobile */
    -webkit-tap-highlight-color: transparent;
    outline: none;

    /* Start invisible (scaled to zero) and positioned below the screen.
       The .appear class below will animate them sliding up and scaling in. */
    transform: scale(0) translateY(200%);

    /* When .fade-out or .removed is added, opacity transitions smoothly to 0. */
    transition: opacity var(--fade-duration) ease;
}

/* Applied by game.js after a random delay — animates the cell from
   scale(0) to scale(1) with a springy overshoot. "forwards" keeps
   the final keyframe (scale 1) after the animation ends. */
.cell.appear {
    animation: bounceIn 0.55s var(--bounce-ease) forwards;
}

/* Applied to every cell simultaneously when the player wins.
   The opacity transition on .cell handles the smooth fade.
   pointer-events: none prevents further clicks during the fade. */
.cell.fade-out {
    opacity: 0;
    pointer-events: none;
}

/* Applied when a cell is removed during play (Go Bananas, Discover the Duplicate).
   Fades out and stops receiving input. */
.cell.removed {
    opacity: 0;
    pointer-events: none;
}

/* ---- Sprite image inside each cell ---- */
/* Shared styles: sprite images and Juice Box button icon (scale, no-drag) */
.cell img,
#juicebox-button img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
    transition: transform 0.4s var(--bounce-ease);
    pointer-events: none;
    -webkit-user-drag: none;
}

/* When hovering a cell with the mouse, the image inside scales up bouncily */
.cell:hover img {
    transform: scale(1.22);
}

/* Cancel the hover scale-up during fade-out or when removed */
.cell.fade-out:hover img,
.cell.removed:hover img {
    transform: scale(1);
}

/* ---- Juice Box button ----
   Positioned in top-left corner, half the size of sprites.
   Uses favicon.png and animates on mouse hover (same as sprites). */
#juicebox-button {
    position: fixed;
    top: calc(var(--cell-size) / 2);
    left: calc(var(--cell-size) / 2);
    width: calc(var(--cell-size) / 2);
    height: calc(var(--cell-size) / 2);
    aspect-ratio: 1;
    padding: 0;
    border: none;
    background: transparent;
    cursor: pointer;
    z-index: 20; /* Above grid but below title screen (z-index 10) */
    overflow: visible;
    
    /* Remove tap highlight on mobile */
    -webkit-tap-highlight-color: transparent;
    outline: none;
    
    /* Hidden by default. JS adds .visible when on mode select or in level. */
    display: none;
}

/* Show Juice Box button when on mode select or in level (class added by app.js) */
#juicebox-button.visible {
    display: block;
}

/* Temporarily hide Juice Box button on touch devices (mobile/tablet) */
@media (hover: none) and (pointer: coarse) {
    #juicebox-button {
        display: none !important;
    }
}

/* Fade transition for the Juice Box button */
#juicebox-button {
    transition: opacity 0.3s ease;
    opacity: 1;
}

/* Fade out the Juice Box button during any transition (drain, return, mode-select→title) */
#juicebox-button.hidden-during-transition {
    opacity: 0;
    pointer-events: none;
}

/* Hover animation: same as sprite hover (mouse only, not touch) */
#juicebox-button:hover img {
    transform: scale(1.22);
}

/* ---- Entrance animation ----
   A spring-like sequence that combines upward movement with scale:
     0%   → invisible (scale 0) and below screen (translateY 200%)
     50%  → overshoot slightly larger than normal, still moving up
     75%  → settle at full size, nearly in position (never goes below scale 1)
     90%  → tiny overshoot, in final position
     100% → settle at full size and final position (translateY 0) */
@keyframes bounceIn {
    0%   { transform: scale(0) translateY(200%)    }
    50%  { transform: scale(1.15) translateY(-5%) }
    75%  { transform: scale(1) translateY(2%)     }
    90%  { transform: scale(1.05) translateY(-1%) }
    100% { transform: scale(1) translateY(0)       }
}
