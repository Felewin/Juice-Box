/*
 * ============================================================
 *  JUICE BOX — Stylesheet
 * ============================================================
 *  This file handles all visual presentation: layout, colors,
 *  animations, and hover effects.
 *
 *  Design tokens (shared values) are stored as CSS custom
 *  properties on :root so they can be reused across rules —
 *  and even read from JavaScript (see timing.js → FADE_MS).
 * ============================================================
 */

/* ---- Design tokens ---- */
:root {
    /* A "bouncy" easing curve that overshoots then settles.
       Used for both the entrance animation and the hover effect. */
    --bounce-ease: cubic-bezier(0.34, 1.56, 0.64, 1);

    /* Title and mode buttons */
    --font-title: "Cherry Bomb One", system-ui;

    /* Each grid cell is a square whose side length is dynamically calculated
       in JavaScript as min(1/(cols+2) of width, 1/(rows+2) of height).
       See level.js GRID_COLUMNS, GRID_ROWS (single source for grid shape). */
    --cell-size: 60px;

    /* How long the fade-out lasts when transitioning between levels.
       timing.js reads this as FADE_MS so LEVEL_TRANSITION_DELAY stays in sync.
       Matches Juice Box button and mode screen (300ms). */
    --fade-duration: 300ms;

    /* Mode button height: 1/(n+2) of viewport (n = button count). Set by updateModeButtonHeight(). */
    --mode-btn-height: auto;

    /* Green–yellow gradient for text (title and mode buttons). Mode buttons omit mint. */
    --gradient-text-mint: #BAFFC9;
    --gradient-text-core: #E0FF9E, #FFFFBA, #FFFFE0, #E8FFBA;
}

/* ---- Reset & global defaults ---- */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;

    /* Prevent mobile browsers from waiting 300ms on tap (to detect
       double-tap-to-zoom). Doesn't inherit, so applying to * ensures
       every element gets it. */
    touch-action: manipulation;
}

/* ---- Full-viewport canvas ---- */
html,
body {
    width: 100%;
    height: 100%;
    overflow: hidden;  /* No scrollbars — the game fills the screen */
    max-width: 100vw;
    max-height: 100vh;
}

body {
    /* Pastel moving gradient (pink, lavender, blue only—no green/yellow so mode button text stays legible) */
    background: linear-gradient(
        to right,
        #FFB3BA, #E0BBE4, #BAE1FF, #B8D4FF, #D4BBFF, #FFB3BA
    );
    background-size: 200% auto;
    background-attachment: fixed;
    animation: pastelGradient 10s linear infinite;
    transition: background 0.3s ease;  /* Used when mode button is clicked */

    /* Center the grid dead-center in the viewport */
    display: flex;
    justify-content: center;
    align-items: center;

    /* Minimal padding to reduce margin between grid and screen edges */
    padding: 0.5%;

    /* Prevent text selection when rapidly clicking sprites */
    user-select: none;
    -webkit-user-select: none;  /* Safari fallback */
}

/* ---- Title screen ----
   Covers the full viewport. First shows the title; a click fades it out
   and shows the mode screen. Clicking a mode starts the game. */
#title-screen {
    position: fixed;
    inset: 0;                       /* Stretch to fill the entire viewport */
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: default;                /* Pointer only on #title and .mode-btn */
    z-index: 10;                    /* Sit above the grid */
    transition: opacity 0.5s ease;
    overflow: hidden;               /* Prevent any content overflow */
    max-width: 100vw;
    max-height: 100vh;

    /* Start invisible to prevent FOUT (Flash of Unstyled Text).
       game.js adds .ready once the Cherry Bomb One font has loaded. */
    opacity: 0;
}

/* Fade in once the font is confirmed loaded */
#title-screen.ready {
    opacity: 1;
}

/* When JS adds .hidden, fade out and disable interaction.
   visibility: hidden ensures the full-viewport layer is fully removed from
   hit-testing so grid hover works reliably in all browsers. */
#title-screen.hidden {
    opacity: 0;
    pointer-events: none;
    visibility: hidden;
}

/* Stack title and mode screen in the same area */
#title,
#mode-screen {
    position: absolute;
    inset: 0;
    display: flex;
    justify-content: center;
    align-items: center;
}

#title {
    cursor: pointer;                 /* Click anywhere on title to advance to mode select */
    font-family: var(--font-title);
    font-weight: 400;
    font-style: normal;
    font-size: calc(min(50vh, 50vw) / 2.2);  /* Two lines; capped by smaller of half height or half width */
    line-height: 1.1;
    text-align: center;
    transition: opacity 0.5s ease;
    animation: titleBreathe 12s ease-in-out infinite;

    /* Stack the two <span> children ("Juice" / "Box") vertically */
    flex-direction: column;
}

/* When mode screen is shown, title fades out */
#title.faded {
    opacity: 0;
    pointer-events: none;
}

/* ---- Mode screen ----
   Juicy card–style buttons: pill shape, frosted glass, larger icons.
   Hover: card lifts with subtle scale, shadow deepens, icon bounces. */
#mode-screen {
    flex-direction: column;
    align-items: center;
    left: 15vw;
    right: 15vw;
    width: auto;
    gap: clamp(1.5vw, 4vmin, 4vw);
    padding: 0;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.5s ease;
}

#mode-screen:not(.hidden) {
    opacity: 1;
    pointer-events: auto;
}

#mode-screen.hidden {
    visibility: hidden;
}

#mode-screen.fade-out {
    opacity: 0;
    transition-duration: 0.3s;  /* Matches Juice Box button fade */
}

/* Juicy pill-shaped card; frosted glass effect; hover: lift + icon bounce.
   height comes from --mode-btn-height (set by updateModeButtonHeight).
   flex: 0 0 prevents growth; content must fit within the allotted slot. */
.mode-btn {
    transition: opacity 0.3s ease, transform 0.3s var(--bounce-ease), box-shadow 0.3s ease;
    display: flex;
    align-items: center;
    flex: 0 0 var(--mode-btn-height);
    gap: clamp(0.4em, 2vw, 1em);
    width: 100%;
    min-height: var(--mode-btn-height);
    padding: clamp(0.5rem, 2vw, 1.25rem) clamp(1rem, 3vw, 1.5rem);
    border: 1px solid rgba(255, 255, 255, 0.45);
    border-radius: 9999px;
    background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.35) 0%,
        rgba(255, 255, 255, 0.15) 100%
    );
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    color: transparent; /* Gradient shows through via background-clip on label */
    font-family: var(--font-title);
    font-weight: 400;
    font-size: clamp(16px, 4.5vw, 36px);
    text-align: left;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    -webkit-tap-highlight-color: transparent;
    outline: none;

    box-shadow:
        0 2px 12px rgba(0, 0, 0, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.5);
}

.mode-btn.fade-out {
    opacity: 0;
    pointer-events: none;
}

.mode-btn:hover {
    transform: scale(1.04);
    box-shadow:
        0 8px 24px rgba(0, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.6);
}

/* ---- Text gradients (title and mode buttons) ----
   Green–yellow gradient clipped to text for legibility on pink/blue/lavender background. */
.moving-gradient-text {
    background: linear-gradient(to right, var(--gradient-text-mint), var(--gradient-text-core), var(--gradient-text-mint));
    background-size: 200% auto;
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    animation: pastelGradient 10s linear infinite;
}

/* Mode buttons: same gradient without mint (so core loops back) */
.mode-btn .moving-gradient-text {
    background-image: linear-gradient(to right, var(--gradient-text-core), #E0FF9E);
}

/* Bigger sprites; hover: gentle bounce */
.mode-btn-icon {
    width: 2.2em;
    height: 2.2em;
    object-fit: contain;
    flex-shrink: 0;
    pointer-events: none;
    transition: transform 0.35s var(--bounce-ease);
}

.mode-btn:hover .mode-btn-icon {
    animation: modeBtnIconBounce 0.5s var(--bounce-ease) forwards;
}

/* Title: slow scale pulse (breathe larger and smaller) */
@keyframes titleBreathe {
    0%, 100% { transform: scale(1); }
    50%      { transform: scale(1.06); }
}

/* Pastel gradient scroll (used by body background) */
@keyframes pastelGradient {
    0%   { background-position: 0% 50%; }
    100% { background-position: 200% 50%; }
}

@keyframes modeBtnIconBounce {
    0%   { transform: scale(1); }
    40%  { transform: scale(1.15); }
    70%  { transform: scale(0.95); }
    100% { transform: scale(1.08); }
}

/* ---- The invisible grid that holds all sprite cells ---- */
#grid {
    display: grid;
    grid-template-columns: repeat(var(--grid-columns), auto);
    grid-template-rows: repeat(var(--grid-rows), auto);
    overflow: visible;                        /* Allow sprites to scale without clipping */
    max-width: 100vw;
    max-height: 100vh;

    /* Responsive gap between cells, same clamping idea as --cell-size */
    gap: clamp(6px, 1.2vmin, 14px);
}

/* ---- Individual sprite cell ---- */
.cell {
    width: var(--cell-size);
    aspect-ratio: 1;                /* Square: height equals width */
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    overflow: visible;              /* Allow sprites to scale beyond cell bounds without clipping */

    /* Remove tap highlight on mobile */
    -webkit-tap-highlight-color: transparent;
    outline: none;

    /* Start invisible (scaled to zero) and positioned below the screen.
       The .appear class below will animate them sliding up and scaling in. */
    transform: scale(0) translateY(200%);

    /* When .fade-out or .removed is added, opacity transitions smoothly to 0. */
    transition: opacity var(--fade-duration) ease;
}

/* Applied by game.js after a random delay — animates the cell from
   scale(0) to scale(1) with a springy overshoot. "forwards" keeps
   the final keyframe (scale 1) after the animation ends. */
.cell.appear {
    animation: bounceIn 0.55s var(--bounce-ease) forwards;
}

/* Applied to every cell simultaneously when the player wins.
   The opacity transition on .cell handles the smooth fade.
   pointer-events: none prevents further clicks during the fade. */
.cell.fade-out {
    opacity: 0;
    pointer-events: none;
}

/* Applied when a cell is removed during play (Go Bananas, Pairy Picking).
   Fades out and stops receiving input. */
.cell.removed {
    opacity: 0;
    pointer-events: none;
}

/* ---- Sprite image inside each cell ---- */
/* Shared styles: sprite images and Juice Box button icon (scale, no-drag) */
.cell img,
#juicebox-button img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
    transition: transform 0.4s var(--bounce-ease);
    pointer-events: none;
    -webkit-user-drag: none;
}

/* When hovering a cell with the mouse, the image inside scales up bouncily */
.cell:hover img {
    transform: scale(1.22);
}

/* Cancel the hover scale-up during fade-out or when removed */
.cell.fade-out:hover img,
.cell.removed:hover img {
    transform: scale(1);
}

/* Incorrect tap: squish while held, spring back on release (wrong sprite only) */
.cell.incorrect-tap img {
    transform: scale(0.88);
}

/* ---- Juice Box button ----
   Positioned in top-left corner, half the size of sprites.
   Uses favicon.png and animates on mouse hover (same as sprites). */
#juicebox-button {
    position: fixed;
    top: calc(var(--cell-size) / 2);
    left: calc(var(--cell-size) / 2);
    width: calc(var(--cell-size) / 2);
    height: calc(var(--cell-size) / 2);
    aspect-ratio: 1;
    padding: 0;
    border: none;
    background: transparent;
    cursor: pointer;
    z-index: 20; /* Above grid but below title screen (z-index 10) */
    overflow: visible;
    
    /* Remove tap highlight on mobile */
    -webkit-tap-highlight-color: transparent;
    outline: none;
    
    /* Hidden by default. JS adds .visible when on mode select or in level. */
    display: none;
}

/* Show Juice Box button when on mode select or in level (class added by app.js) */
#juicebox-button.visible {
    display: block;
}

/* Temporarily hide Juice Box button on touch devices (mobile/tablet) */
@media (hover: none) and (pointer: coarse) {
    #juicebox-button {
        display: none !important;
    }
}

/* Fade transition for the Juice Box button */
#juicebox-button {
    transition: opacity 0.3s ease;
    opacity: 1;
}

/* Fade out the Juice Box button during any transition (drain, return, mode-select→title) */
#juicebox-button.hidden-during-transition {
    opacity: 0;
    pointer-events: none;
}

/* Hover animation: same as sprite hover (mouse only, not touch) */
#juicebox-button:hover img {
    transform: scale(1.22);
}

/* ---- Entrance animation ----
   A spring-like sequence that combines upward movement with scale:
     0%   → invisible (scale 0) and below screen (translateY 200%)
     50%  → overshoot slightly larger than normal, still moving up
     75%  → settle at full size, nearly in position (never goes below scale 1)
     90%  → tiny overshoot, in final position
     100% → settle at full size and final position (translateY 0) */
@keyframes bounceIn {
    0%   { transform: scale(0) translateY(200%)    }
    50%  { transform: scale(1.15) translateY(-5%) }
    75%  { transform: scale(1) translateY(2%)     }
    90%  { transform: scale(1.05) translateY(-1%) }
    100% { transform: scale(1) translateY(0)       }
}
